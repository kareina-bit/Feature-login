<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Shipway - Ví & Thanh toán</title>
  <link rel="stylesheet" href="css/wallet.css">
</head>

<body>
<div class="page">

  <!-- ===== HEADER ===== -->
  <div class="header">
    <a href="../onboarding-fe/index.html" class="back-home-btn" title="Quay về trang chủ">
      <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
        <line x1="19" y1="12" x2="5" y2="12"></line>
        <polyline points="12 19 5 12 12 5"></polyline>
      </svg>
    </a>
    <img src="../auth-service/img/logo.png" alt="Shipway" class="logo-img">
    <p class="desc">
      Quản lý ví và thanh toán<br>
      Nạp tiền và xem lịch sử giao dịch
    </p>
  </div>

  <!-- ===== WALLET BALANCE ===== -->
  <div class="card">
    <h2>Số dư tài khoản</h2>
    <div class="balance-display">
      <div class="balance-amount" id="walletBalance">0.000 ₫</div>
      <div class="balance-label">Số dư khả dụng</div>
    </div>
    <button class="btn-primary" onclick="showQrPayment()">Nạp tiền qua QR</button>
  </div>

  <!-- ===== QUICK ACTIONS ===== -->
  <div class="card">
    <h3>Thao tác nhanh</h3>
    <div class="action-buttons">
      <button class="btn-secondary" onclick="showTransactionHistory()">
        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <path d="M12 2v20M17 5H9.5a3.5 3.5 0 0 0 0 7h5a3.5 3.5 0 0 1 0 7H6"></path>
        </svg>
        Lịch sử giao dịch
      </button>
      <button class="btn-secondary" onclick="showQrPayment()">
        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <rect x="3" y="3" width="18" height="18" rx="2" ry="2"></rect>
          <rect x="7" y="7" width="3" height="3"></rect>
          <rect x="14" y="7" width="3" height="3"></rect>
          <rect x="7" y="14" width="3" height="3"></rect>
          <rect x="14" y="14" width="3" height="3"></rect>
        </svg>
        Nạp tiền
      </button>
    </div>
  </div>

  <!-- ===== TRANSACTION HISTORY ===== -->
  <div class="card" id="transactionHistoryCard">
    <h3>Lịch sử giao dịch gần đây</h3>
    <div class="transaction-list" id="transactionList">
      <!-- Transactions will be loaded here -->
    </div>
    <button class="btn-outline" onclick="loadMoreTransactions()">Xem thêm</button>
  </div>

  <!-- ===== QR PAYMENT MODAL ===== -->
  <div id="qrPaymentModal" class="modal hidden">
    <div class="modal-content">
      <div class="modal-header">
        <h3>Nạp tiền qua mã QR</h3>
        <button class="modal-close" onclick="closeQrPayment()">&times;</button>
      </div>
      <div class="modal-body">
        <div class="qr-container">
          <div id="qrCode" class="qr-code">
            <!-- QR code will be generated here -->
          </div>
          <p class="qr-instruction">Quét mã QR để nạp tiền</p>
        </div>
        <div class="amount-input">
          <label for="topupAmount">Số tiền nạp (₫):</label>
          <input type="number" id="topupAmount" placeholder="Nhập số tiền" min="10000" step="1000" value="50000">
        </div>
        <button class="btn-primary" onclick="generateQrCode()">Tạo mã QR</button>
      </div>
    </div>
  </div>

</div>

<!-- Scripts -->
<script type="module">
  import { initWallet } from './js/wallet.js';
  import { loadTransactionHistory } from './js/history.js';
  import { initQrPayment } from './js/qr-payment.js';

  // Initialize wallet functionality
  document.addEventListener('DOMContentLoaded', () => {
    initWallet();
    loadTransactionHistory();
    initQrPayment();
  });

  // Global functions for onclick handlers
  window.showTransactionHistory = function() {
    document.getElementById('transactionHistoryCard').scrollIntoView({ behavior: 'smooth' });
  };

  window.showQrPayment = function() {
    document.getElementById('qrPaymentModal').classList.remove('hidden');
    generateQrCode();
  };

  window.closeQrPayment = function() {
    document.getElementById('qrPaymentModal').classList.add('hidden');
  };

  window.generateQrCode = function() {
    const amount = document.getElementById('topupAmount').value;
    // QR code generation will be handled by qr-payment.js
    if (window.generateQR) {
      window.generateQR(amount);
    }
  };

  window.loadMoreTransactions = function() {
    // Load more transactions will be handled by history.js
    if (window.loadMore) {
      window.loadMore();
    }
  };
</script>
</body>
</html>

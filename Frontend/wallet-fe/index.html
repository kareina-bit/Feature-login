<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Shipway - Ví & Thanh toán</title>
  <link rel="stylesheet" href="css/wallet.css">
</head>

<body>
<div class="page">

  <!-- ===== HEADER ===== -->
  <div class="header">
    <a href="../onboarding-fe/index.html" class="back-home-btn" title="Quay về trang chủ">
      <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
        <line x1="19" y1="12" x2="5" y2="12"></line>
        <polyline points="12 19 5 12 12 5"></polyline>
      </svg>
    </a>
    <img src="../auth-service/img/logo.png" alt="Shipway" class="logo-img">
    <p class="desc">
      Quản lý ví và thanh toán<br>
      Nạp tiền và xem lịch sử giao dịch
    </p>
  </div>

  <!-- ===== WALLET BALANCE ===== -->
  <div class="card">
    <h2>Số dư tài khoản</h2>
    <div class="balance-display">
      <div class="balance-amount" id="walletBalance">0.000 ₫</div>
      <div class="balance-label">Số dư khả dụng</div>
    </div>
    <button class="btn-primary" onclick="goToTopup()">
  Nạp tiền vào tài khoản
</button>
  </div>

  <!-- ===== PAYMENT METHODS ===== -->
  <div class="card">
    <h3>Đơn hàng cần thanh toán</h3>
    <div class="table-responsive">
      <table class="order-table">
        <thead>
          <tr>
            <th>ID Đơn</th>
            <th>Địa điểm</th>
            <th>Giá tiền</th>
            <th>Thao tác</th>
          </tr>
        </thead>
        <tbody id="unpaidOrderList">
          <tr>
            <td>#SW1024</td>
            <td>Quận 1, TP.HCM</td>
            <td><strong>50.000 ₫</strong></td>
            <td>
              <button class="btn-pay-small" onclick="payOrder('SW1024')">Thanh toán</button>
            </td>
          </tr>
          <tr>
            <td>#SW1025</td>
            <td>Quận 7, TP.HCM</td>
            <td><strong>120.000 ₫</strong></td>
            <td>
              <button class="btn-pay-small" onclick="payOrder('SW1025')">Thanh toán</button>
            </td>
          </tr>
        </tbody>
      </table>
    </div>
  </div>

  <!-- ===== TRANSACTION HISTORY ===== -->
  <div class="card" id="transactionHistoryCard">
    <h3>Lịch sử giao dịch gần đây</h3>
    <div class="transaction-list" id="transactionList">
      <!-- Transactions will be loaded here -->
    </div>
    <button class="btn-outline" onclick="loadMoreTransactions()">Xem thêm</button>
  </div>


</div>

<!-- Scripts -->
<script type="module">
  import { initWallet } from './js/wallet.js';
  import { loadTransactionHistory } from './js/history.js';
  import { initQrPayment } from './js/qr-payment.js';

  // Initialize wallet functionality
  document.addEventListener('DOMContentLoaded', () => {
    initWallet();
    loadTransactionHistory();
    initQrPayment();
  });
let selectedTopupMethod = 'qr';

window.switchTopupMethod = function(method) {
  selectedTopupMethod = method;

  document.getElementById('qrSection').classList.toggle('hidden', method !== 'qr');
  document.getElementById('visaSection').classList.toggle('hidden', method !== 'visa');
};
function goToTopup() {
    window.location.href = 'topup.html';
  }
window.confirmTopup = function() {
  const amount = parseInt(document.getElementById('topupAmount').value);

  if (!amount || amount < 10000) {
    alert('Số tiền nạp không hợp lệ');
    return;
  }

  document.querySelector('.modal-body').innerHTML = `
    <p style="text-align:center">Đang xử lý thanh toán...</p>
  `;

  setTimeout(() => {
    const currentBalance = parseFloat(localStorage.getItem('walletBalance') || '0');
    localStorage.setItem('walletBalance', currentBalance + amount);

    alert(
      selectedTopupMethod === 'qr'
        ? 'Nạp tiền thành công qua QR'
        : 'Nạp tiền thành công qua Visa'
    );

    closeQrPayment();
    window.location.reload();
  }, 5000);
};

  // Global functions for onclick handlers
  window.showTransactionHistory = function() {
    document.getElementById('transactionHistoryCard').scrollIntoView({ behavior: 'smooth' });
  };
 window.payOrder = function(orderId, amount) {
    // Lưu thông tin đơn hàng để trang payment dùng
    localStorage.setItem('currentOrder', JSON.stringify({
      orderId,
      amount
    }));

    // Điều hướng sang trang thanh toán
    window.location.href = 'payment.html';
  };
  window.selectPaymentMethod = function(method) {
    // Remove active class from all methods
    document.querySelectorAll('.payment-method').forEach(el => {
      el.classList.remove('active');
    });
    
    // Add active class to selected method
    event.currentTarget.classList.add('active');
    
    // Store selected method
    localStorage.setItem('selectedPaymentMethod', method);
  };

  window.goToTopup = function() {
    window.location.href = 'topup.html';
  };

  window.showQrPayment = function() {
    document.getElementById('qrPaymentModal').classList.remove('hidden');
    generateQrCode();
  };

  window.closeQrPayment = function() {
    document.getElementById('qrPaymentModal').classList.add('hidden');
  };

  window.generateQrCode = function() {
    const amount = document.getElementById('topupAmount').value;
    // QR code generation will be handled by qr-payment.js
    if (window.generateQR) {
      window.generateQR(amount);
    }
  };

  window.loadMoreTransactions = function() {
    // Load more transactions will be handled by history.js
    if (window.loadMore) {
      window.loadMore();
    }
  };
</script>
</body>
</html>
